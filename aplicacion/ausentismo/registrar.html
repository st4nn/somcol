<style>
	.frmAusentismo_Registrar_Control 
	{
		border: none;
		border-bottom: solid 1px black;
	}

</style>
<div class="page" style="min-height: 90vh;">
	<div class="page-header">
		<h3 class="page-title">Registar Ausentismo</h3>
	</div>
 	<div class="page-content container-fluid">
        <div class="panel panel-primary panel-bordered">
            <div class="panel-heading">
                <div class="panel-actions">
                    <button class="btn btn-warning lnkAbrirModulo" Titulo="Listado de Personal" vinculo="ausentismo/home.html"><i class="icon fa-arrow-left"></i> Volver</button>
                </div>
            </div>
            <div class="panel-body">
            	<form id="frmAusentismo_Registrar_DatosUsuario">
            		<input id="txtAusentismo_Registrar_id" type="hidden" class="frmAusentismo_Registrar_Control form-control">
            		<div class="row">
				 		<div class="form-group col-sm-5 pull-right">
				 			<div class="form-group">
				 				<label for="txtAusentismo_Registrar_Cedula" class="control-label">Cedula</label>
			                    <input id="txtAusentismo_Registrar_Cedula" class="form-control">
			                </div>
				        </div>
			 		</div>

            		<div class="row">
			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_Nombres" class="control-label">Nombres</label>
					        	<input class="frmAusentismo_Registrar_Control form-control" id="txtAusentismo_Registrar_Nombres">
					        </div>
			 			</div>

			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_Apellidos" class="control-label">Apellidos</label>
					        	<input class="frmAusentismo_Registrar_Control form-control" type="text" id="txtAusentismo_Registrar_Apellidos">
					        </div>
			 			</div>
			 		</div>

			 		<div class="row">
			 			<div class="col-sm-6">
				 			<div class="col-sm-6">
					 			<div class="form-group">
						        	<label for="txtAusentismo_Registrar_FechaNacimiento" class="control-label">Fecha de Nacimiento</label>
						        	<input class="frmAusentismo_Registrar_Control form-control datepicker" id="txtAusentismo_Registrar_FechaNacimiento">
						        </div>
				 			</div>
				 			<div class="col-sm-6">
					 			<div class="form-group">
						        	<label for="txtAusentismo_Registrar_FechaNacimiento" class="control-label">Edad</label>
						        	<input class="frmAusentismo_Registrar_Control form-control datepicker" id="txtAusentismo_Registrar_Edad">
						        </div>
				 			</div>
				 		</div>

			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_Genero" class="control-label">Genero</label>
					        	<select class="frmAusentismo_Registrar_Control form-control" id="txtAusentismo_Registrar_Genero">
					        		<option value=""></option>
					        		<option value="M">Masculino</option>
					        		<option value="F">Femenino</option>
					        	</select>
					        </div>
			 			</div>
			 		</div>

			 		<div class="row">
			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_Cargo" class="control-label">Cargo</label>
					        	<input class="frmAusentismo_Registrar_Control form-control" id="txtAusentismo_Registrar_Cargo">
					        </div>
			 			</div>

			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_Grupo" class="control-label">Grupo</label>
					        	<select class="frmAusentismo_Registrar_Control form-control" id="txtAusentismo_Registrar_Grupo">
					        		<option value=""></option>
					        		<option value="Operativo">Operativo</option>
					        		<option value="Administrativo">Administrativo</option>
					        	</select>
					        </div>
			 			</div>
			 		</div>

			 		<div class="row">
			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_Regional" class="control-label">Regional</label>
					        	<input class="frmAusentismo_Registrar_Control form-control" id="txtAusentismo_Registrar_Regional">
					        </div>
			 			</div>

			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_NombreEPS" class="control-label">Nombre de Entidad EPS</label>
					        	<input class="frmAusentismo_Registrar_Control form-control" type="text" id="txtAusentismo_Registrar_NombreEPS">
					        </div>
			 			</div>
			 		</div>
			 	</form>
            </div>
        </div>
        <div class="panel panel-primary panel-bordered">
            <div class="panel-heading">
                <div class="panel-actions">
                </div>
            </div>
            <div class="panel-body">
            	<form id="frmAusentismo_Registrar">
            		<input class="guardar" type="hidden" id="txtAusentismo_Registrar_id" value="NULL">
            		<input class="guardar" type="hidden" id="txtAusentismo_Registrar_Prefijo" value="NULL">
            		<div class="row">
			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_TipoEvento" class="control-label">Tipo de Evento</label>
					        	<select class="form-control guardar" id="txtAusentismo_Registrar_TipoEvento" required="true">
					        		<option value="Accidentalidad">Accidentalidad</option>
					        		<option value="Maternidad">Maternidad</option>
					        		<option value="Paternidad">Paternidad</option>
					        		<option value="Deportivo">Deportivo</option>
					        		<option value="Enfermedad General">Enfermedad General</option>
					        		<option value="Licencia no Remunerada">Licencia no Remunerada</option>
					        		<option value="Alcohol">Alcohol</option>
					        		<option value="Por Sanciones">Por Sanciones</option>
					        	</select>
					        </div>
			 			</div>

			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_IncapacidadTipo" class="control-label">Incapacidad</label>
					        	<select class="form-control guardar" id="txtAusentismo_Registrar_IncapacidadTipo" required="true">
					        		<option value="Inicial">Inicial</option>
					        		<option value="Prorroga">Prorroga</option>
					        	</select>
					        </div>
			 			</div>
			 		</div>

			 		<div class="row">
			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_FechaInicial" class="control-label">Fecha Inicial</label>
					        	<input class="form-control guardar datepicker" id="txtAusentismo_Registrar_FechaInicial" required="true">
					        </div>
			 			</div>

			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_IncapacidadTipo" class="control-label">Fecha Final</label>
					        	<input class="form-control guardar datepicker" type="text" id="txtAusentismo_Registrar_FechaFinal" required="true">
					        </div>
			 			</div>
			 		</div>

			 		<div class="row">
			 			<div class="col-sm-6">
				 			<div id="cntAusentismo_Registrar_CodigoDiagnostico" class="form-group">
					        	<label for="txtAusentismo_Registrar_CodigoDiagnostico" class="control-label">Código Diagnóstivo</label>
					        	<input class="form-control guardar" id="txtAusentismo_Registrar_CodigoDiagnostico" required="true">
					        </div>
			 			</div>

			 			<div class="col-sm-6">
				 			<div class="form-group">
					        	<label for="txtAusentismo_Registrar_Descripcion" class="control-label">Observaciones</label>
					        	<textarea class="form-control guardar" id="txtAusentismo_Registrar_Observaciones"></textarea>
					        </div>
			 			</div>
			 		</div>

			 		<button type="submit" class="btn btn-success btn-block text-center">Guardar</button>
            	</form>
            </div>
        </div>

        <div class="col-sm-12">
 			<div class="panel panel-bordered panel-primary">
                <div class="panel-body">
                    <div>
                        <h4></h4>
                        <div id="cntAusentismo_Registro_Archivos"></div>
                    </div>
                    
                </div>
            </div>
 		</div>
	</div>
</div>
<style>
	#cntAusentismo_Registrar_CodigoDiagnostico .tt-dropdown-menu {
	  max-height: 150px;
	  overflow-y: auto;
	}
</style>
<script>
	$(document).ready(function()
	{		
		$('#frmAusentismo_Registrar .datepicker').datepicker({
	        clearBtn: true,
	        language: "es",
	        orientation: "top auto",
	        daysOfWeekHighlighted: "0",
	        autoclose: true,
	        todayHighlight: true
	    });

	    $('#txtAusentismo_Registrar_Cedula').on('change', function()
	    {
	    	var Cedula = $(this).val();
	    	$('#frmAusentismo_Registrar_DatosUsuario')[0].reset();
	    	$('#txtAusentismo_Registrar_Cedula').val(Cedula);

	    	$.post('../server/php/proyecto/personal_TraerPorCedula.php', {Usuario: Usuario.id, idEmpresa : $('#txtInicio_idEmpresa').val(), Cedula : Cedula}, function(data, textStatus, xhr) 
	    	{
	    		if (data != 0)
	    		{
	    			$.each(data, function(index, val) 
	    			{
	    				 if ($('#txtAusentismo_Registrar_' + index).length != 0)
	    				 {
	    				 	$('#txtAusentismo_Registrar_' + index).val(val);	
	    				 }
	    			});

	    			var tEdad = calcularEdad($('#txtAusentismo_Registrar_FechaNacimiento').val());
	    			$('#txtAusentismo_Registrar_Edad').val(tEdad.anios);


	    		}
	    	}, 'json');
	    });

	    $('#frmAusentismo_Registrar').on('submit', function(evento)
	    {
	    	evento.preventDefault();
	    	$(this).generarDatosEnvio('txtAusentismo_Registrar_', function(datos)
	    	{
	    		datos = $.parseJSON(datos);
      			datos.idEmpresa = $('#txtInicio_idEmpresa').val();
      			datos.idPersonal = $('#txtAusentismo_Registrar_id').val();
      			datos.Edad = $('#txtAusentismo_Registrar_Edad').val();

      			if (datos.idPersonal == ''){
      				Mensaje('Error', 'Debes ingresar una Cedula válida y registrada', 'danger');
      				$('#txtAusentismo_Registrar_Cedula').focus();
      			} else {
	      			$.post('../server/php/proyecto/ausentismo_registrar.php', datos, function(data, textStatus, xhr) 
	      			{
	      				if (isNaN(data))
				        {
				          Mensaje('Error', data, 'danger');
				        } else
				        {
				          Mensaje("!", 'Los datos han sido ingresados correctamente', 'success');
				          $('#frmAusentismo_Registrar')[0].reset();
				        }
	      			});
      			}
	    	});
	    });

	    var cieX = new Bloodhound({
		  datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
		  queryTokenizer: Bloodhound.tokenizers.whitespace,
		  remote: {
		    url: '../server/php/proyecto/cargarCieX.php?p=%QUERY',
		    wildcard: '%QUERY'
		  }
		});

	    $('#txtAusentismo_Registrar_CodigoDiagnostico').typeahead(null, {
		  name: 'cieX',
		  display: 'Codigo',
		  source: cieX,
		  templates: {
		    empty: [
		      '<div class="empty-message">',
		        'Ningún código coincide con la descripción escrita',
		      '</div>'
		    ].join('\n'),
		    suggestion: Handlebars.compile('<div><strong>{{Codigo}}</strong> – {{Descripcion}}<br><i>{{Sistema}}</i> <small>{{Subsistema}}</small></div>')
		   }
		});
	});

	function personalAgregarPersona_Nuevo(){
		$('#frmAusentismo_Registrar')[0].reset();
		$('#txtAusentismo_Registrar_Prefijo').val(obtenerPrefijo());

		$("#cntAusentismo_Registro_Archivos").iniciarObjArchivos({objPrefijo : $("#txtAusentismo_Registrar_Prefijo"), Proceso: "Registro Ausentismo", Usuario: Usuario.id});

		$("#cntAusentismo_Registro_Archivos").cargarArchivos({Prefijo : $("#txtAusentismo_Registrar_Prefijo").val(), Proceso : 'Registro Ausentismo'});
	}
</script>